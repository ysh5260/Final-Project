<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<style>
.modal {
	position: fixed;
	z-index: 100;
}

#studyListTbl tr, #timeTbl tr {
	user-select: none;
}

#studyListTbl tr {
	cursor: pointer;
}
</style>
<!-- ===================[fullCalendar 6.1.4 CDN]===================== -->
<!--  fullCalendar 6.1.4ë²„ì „ CDN -->
<script
	src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.4/index.global.min.js"></script>
<!-- fullCalendar 6.1.4ë²„ì „ ì–¸ì–´ ì„¤ì • -->
<script src="/resources/fullcalendar/ko.global.min.js"></script>
<!-- ===================[fullCalendar 6.4.1 CDN]===================== -->
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script>/* ìº˜ë¦°ë” ìŠ¤í¬ë¦½íŠ¸ */
	(function () {
		$(function () {
			var studyCode = $('#studyCode').val();
			console.log(">>>", studyCode);
			let data = { "studyCode": studyCode };

			var request = $.ajax({
				url: "/calendar/list/",
				type: "post",
				dataType: 'json',
				contentType: 'application/json',
				data: JSON.stringify(data)

			});
			request.fail(function (jqXHR, textStatus) {
				alert("ì˜¤ë¥˜ë°œìƒ!! : " + textStatus);
			});

			request.done(function (data) {

				console.log("studyCode : ", data[0].groupId);

				$("input[name=studyCode]").val(data[0].groupId);

				var modalElement = document.getElementById('calendarModal')
				var modal = new bootstrap.Modal(modalElement);
				//ë£¸ì½”ë“œ..ì¶”ê°€í•´ë³´ì
				var id = $("#calNo").val();
				var groupId = studyCode;
				console.log("studyCode>>>", studyCode);
				var title = $("#calendar_title"); //ì¼ì • ì œëª©
				var content = $("#calendar_content"); //ì¼ì • ë‚´ìš©
				var barColor = $(".barColor"); // ìƒ‰ìƒ

				var startTime = $("#startTime"); //ì‹œì‘ì‹œê°„
				var endTime = $("#endTime"); //ì¢…ë£Œì‹œê°„
				var start = $("#calendar_start_date");
				var end = $("#calendar_start_date");

				var saveBtn = $("#addCalendar");
				var closeBtn = $("#closeBtn");
				var modalCloseBtn = $("#modalClose");
				var deleteBtn = $("#delCalendar");
				var flag = false;

				//saveBtn ì‹œì‘//////////////////////////////////////////
				saveBtn.on("click", function () {
					console.log("flag == ", flag);
					var groupId = studyCode;
					console.log("studyCode : ", groupId);
					var title = $("#calendar_title");
					var content = $("#calendar_content");
					var barColor = $(".barColor");

					var startTime = $("#startTime");
					var endTime = $("#endTime");
					var allDay = $("#allDay");
					var start = $("#calendar_start_date");
					var end = $("#calendar_end_date");

					var saveBtn = $("#addCalendar");
					var closeBtn = $("#closeBtn");
					var modalCloseBtn = $("#modalClose");
					var deleteBtn = $("#delCalendar");

					//ì¼ì •ë“±ë¡
					if (flag == true) {
						titleInput = title.val();
						contentInput = content.val();
						console.log("allDayì²´í¬ ::", allDay.val());

						startTimeInput = startTime.val();
						endTimeInput = endTime.val();
						//ìŠ¤ìœ—ì•ŒëŸ¬íŠ¸ë¡œ ë°”ê¾¸ê¸°
						//alert("startTimeInput : " + startTimeInput + ", endTimeInput : " + endTimeInput);

						startInput = document.getElementById('calendar_start_date').value;
						endInput = document.getElementById('calendar_end_date').value;

						barColorInput = $('input[name=optradioCustom]:checked').data('value');//ìƒ‰ì¶”ê°€

						console.log("startInput : " + startInput);

						console.log("title : " + titleInput + ", content : " + contentInput + "startDate : " + startInput);

						// value="T" ì²´í¬ë°•ìŠ¤ì„¤ì •ì„...ì…ë ¥ê°’ì„ ë°›ì•„ì™€ì„œ ë””ë¹„ì— ì €ì¥
						/*                   if(allDay.val() == 'T'){ //ì¼ì •ì´ í•˜ë£¨ì¢…ì¼ì¸ ê²½ìš°
																 $.ajax({
																		type : "POST",
																		url : "/calendar/register",
																		data :{
																			 'title' : titleInput,
																			 'content' : contentInput,
																			 'startDate' : startInput + "T" + "00:00:00",
																			 'endDate ' : startInput + "T" + "24:00:00"
																		},
																		success : function(res){
																			 alert("ì¼ì •ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.");
																			 location.reload();
																					if(title == null || title == ""){
																						 alert("ì¼ì •ì˜ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”.");
																					}
																					if(content == null || content == ""){
																						 alert("ì¼ì •ì˜ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”.");
																					}
																					if(new Date(endInput) - new Date(startInput) < 0){
																						 alert("ì¢…ë£Œì¼ì´ ì‹œì‘ì¼ë³´ë‹¤ ë¨¼ì €ì…ë‹ˆë‹¤.")
																					}
																		}
																 });
															} */
						$.ajax({
							type: "POST",
							url: "/calendar/register",
							data: {
								'studyCode': studyCode,
								'scTitle': titleInput,
								'scContent': contentInput,
								'scSdate': startInput + "T" + startTimeInput,
								'scEdate': endInput + "T" + endTimeInput,
								'scBarColor': barColorInput // ìƒ‰ì¶”ê°€
							},
							    success: function(res){
								alert("ì¼ì •ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.");
								location.href = "/study/detail/" + studyCode + "?active=2";
								//ë£¸ì½”ë“œëŠ” ì´ëŸ°ê±° ì—†ì–´ë„ ë˜ì§€ ì•Šì„ê¹Œ ê°•ì œë¡œ ë„£ëŠ”ê±´ë°.....
								if (title == null || title == "") {
									alert("ì¼ì •ì˜ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”.");
								}
								if (content == null || content == "") {
									alert("ì¼ì •ì˜ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”");
								}
								if (new Date(endInput) - new Date(startInput) < 0) {
									alert("ì¢…ë£Œì¼ì´ ì‹œì‘ì¼ë³´ë‹¤ ë¨¼ì €ì…ë‹ˆë‹¤.");
								}
							}
						});
						$("#calendar_content").val('');
						$("#calendar_start_date").val('');
						$("#calendar_end_date").val('');
						$(".barColor").data('value', ''); //ìƒ‰ì¶”ê°€
						modal.hide();
						//ê¹œë¹¡
						location.reload();

					} else {
						id = $("#calNo").val();
						groupId = $("#studyCode").val();
						title = $("#calendar_title").val();
						content = $("#calendar_content").val();
						startDate = $("#calendar_start_date").val();
						endDate = $("#calendar_end_date").val();
						startTime = $("#startTime").val();
						endTime = $("#endTime").val();
						barColor = $('input[name=optradioCustom]:checked').data('value'); //ìƒ‰ì¶”ê°€

						// console.log(">> ìˆ˜ì • : " + id + ", " + groupId + ", " + title + ", " + content + ", " + startDate + ", " + startTime);
						console.log(">> ìˆ˜ì • : ", barColor);
						var param = {
							'scNo': id,
							'studyCode': groupId,
							'scTitle': title,
							'scContent': content,
							'scSdate': startDate + "T" + startTime,
							'scEdate': endDate + "T" + endTime,
							'scBarColor': barColor//ìƒ‰ ì¶”ê°€í•¨
						}
						$.ajax({
							type: "post",
							url: "/calendar/update",
							data: param,
							dataType: "json",
							success: function (req) {
								console.log(reg);
							}
						}); //ajax end
						alert("ìˆ˜ì • ì™„ë£Œ");
						modal.hide();
						location.reload();
					}
				});
				//saveBtnë///////////////////////////////////////

				//deleteBtn ì‹œì‘/////////////////////////////////////
				deleteBtn.on("click", function () {
					id = $("#calNo").val();
					var param = {
						'scNo': id,
					}
					if (confirm("ì‚­ì œí• êº¼ì•¼?")) {
						$.ajax({
							type: "post",
							url: "/calendar/remove",
							data: param,
							dataType: "json",
							success: function (req) {
								console.log("reg : " + req);
							}
						});
						alert(title + "ì‚­ì œë˜ì—ˆì–´")
						//  event.remove(); // ìº˜ë¦°ë” í™”ë©´ì—ì„œ í•´ë‹¹ ì¼ì • ì‚­ì œ
						modal.hide();
						location.reload();
					}   // if(confirm) end
				});
				//deleteBtn ë////////////////////////////////////////


				//closeBtn ì‹œì‘//////////////////////////////////////////

				// modal [x] ë²„íŠ¼
				closeBtn.on("click", function () {
					//modal ì°½ ë‚´ìš© ì´ˆê¸°í™”
					$("#studyCode").val('');
					$("#calendar_title").val('');
					$("#calendar_content").val('');
					$("#calendar_start_date").val('');
					$("#calendar_end_date").val('');
					$(".barColor").data('value', ''); //ìƒ‰ê¹”
					calendar.unselect();
					console.log("xë²„íŠ¼ í´ë¦­")
					modal.hide();
				});
				//closeBtn ë//////////////////////////////////////////

				//modalClose ì‹œì‘/////////////////////////////////////
				//modal [ì·¨ì†Œ] ë²„íŠ¼
				modalCloseBtn.on("click", function () {
					//modal ì°½ ì´ˆê¸°í™”
					$("#studyCode").val('');
					$("#calendar_title").val('');
					$("#calendar_content").val('');
					$("#calendar_start_date").val('');
					$("#calendar_end_date").val('');
					$(".barColor").data('value', ''); //ìƒ‰ê¹”
					calendar.unselect();
					console.log("ì·¨ì†Œë²„íŠ¼ í´ë¦­");
					modal.hide();
				});
				////modalClose ë/////////////////////////////////////

				//logë¡œ controllerì—ì„œ ë„˜ì–´ì˜¨ ë°ì´í„° ì •ë³´
				console.log("dataê°€ ì˜ ë„˜ì–´ì˜¤ëŠ”ì§€.." + JSON.stringify(data));
				var calendarElement = $('#calendar')[0];

				/////////////////////////////////////////////////
				// full-calendar ìƒì„±////////////////////////
				var calendar = new FullCalendar.Calendar(calendarElement, {
					//                   height:700px,
					//                   width:800px,
					expandRows: true, //ë†’ì´ ë§ê²Œ ì¬ì„¤ì •
					//í—¤ë”ì— í‘œì‹œí•  íˆ´ë°”
					headerToolbar: {
						left: 'prev,next,today',
						center: 'title',
						right: 'dayGridMonth, timeGridWeek, timeGridDay, listWeek'
					},
					initialView: 'dayGridMonth', // ì´ˆê¸° ë¡œë“œ í™”ë©´
					navLinks: true, // ë‚ ì§œ ì„ íƒì‹œ daysk week ìº˜ë¦°ë”ë¡œ
					editable: true, //ìˆ˜ì • ê°€ëŠ¥ ì—¬ë¶€
					//                   dropable: true,
					//                   selectHelper: true,
					selectable: true, //ë‹¬ë ¥ ì¼ì ë“œë˜ê·¸
					nowIndicator: true, //í˜„ì¬ ì‹œê°„ ë§ˆí¬
					dayMaxEvents: true, //ì´ë²¤íŠ¸ê°€ ì˜¤ë²„ë˜ë©´ ë†’ì´ ì œí•œ(+ëª‡ ê°œ)
					locale: 'ko',      //í•œêµ­ì–´ ì„¤ì •

					//select ì‹œì‘
					select: function (info) { //ìº˜ë¦°ë”ì—ì„œ ë“œë˜ê·¸ì´ë²¤íŠ¸
						flag = true;
						console.log("info1 >>", info);
						//ì´ê²Œ ì—†ìœ¼ë©´ 
						$("#deleteCalendar").hide(); //'ì‚­ì œ' ë²„íŠ¼ì´ ë‚¨ì•„ìˆëŠ” ê²ƒì„ ìˆ¨ê¹€
						modal.show();

						console.log("title : ", title);
						//ì´ë¶€ë¶„ì´ if(title == null || title == ""){ ì˜€ìŒ
						//ì‚¬ì‹¤ìƒ ëª¨ì–‘ë§Œ ì¶”ê°€ë¡œ í•œë‹¤ëŠ” ê²ƒì„
						if (flag = true) {
							$("#addCalendar").text("ì¶”ê°€");
						}

						$('#calendarModal').modal();
						var saveBtn = $("#addCalendar");

						$("#calendar_start_date").val(info.startStr); //startStrì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ìˆëŠ”ê±¸ê¹Œ
						$("#calendar_end_date").val(info.endStr);

						calendar.unselect() //ì¼ì • ì„ íƒ ì·¨ì†Œ ì‹œ ì‹¤í–‰ë  ì½”ë“œ ì‘ì„±
					},
					//select ë
					//eventClick ì‹œì‘
					eventClick: function (info) { //ë“±ë¡ ì¼ì • í´ë¦­í–ˆì„ë•Œ
						console.log("info2 >>", info.event);
						console.log(calendar.getEvents());//ìº˜ë¦°ë” ì•ˆì˜ ë°ì´í„° í™•ì¸ìš©
						console.log("í´ë¦­ì´ ë§ì´ ë˜ëŠ”ë° í•˜ë‚˜ë§Œ ë˜ì–´ì•¼í•´ >>>>", JSON.stringify(info.event.id));
						//$("#calNo").val(info.event.extendedProps.no); ìˆ˜ì •í•¨
						$("#calNo").val(info.event.id); //ì´ë ‡ê²Œ ì“°ëŠ”ê²Œ ì•„ë‹ˆê³  ì›ì²´ì—†ëŠ” ê°’ì´ë©´ extendedPropsë¥¼ ê¼­ ì¨ì¤˜ì•¼í•´
						console.log("ì•„ì´ë””:", info.event.id);
						//$("#studyCode").val(info.event.extendedProps.studyCode);
						$("#studyCode").val(info.event.groupId);
						//ì´ë¶€ë¶„ì´ ë¨¸ë”ë¼.. ì•„ë§ˆ ì²˜ìŒ ì…‹íŒ… ê°’ì¸ë“¯ 
						var startDate = info.event.startStr.split('T')[0];
						var startTime = (info.event.startStr.split('T')[1]).split('+')[0];
						var endDate = info.event.endStr.split('T')[0];
						var endTime = (info.event.endStr.split('T')[1]).split('+')[0];



						// splitì€ ë¬¸ìì—´ì„ ì¸ìë¡œ ì£¼ì–´ì§„ ë¬¸ìì—´ì„ 
						// ê¸°ì¤€ìœ¼ë¡œ ìª¼ê°œì„œ ë°°ì—´ì— ë‹´ëŠ”ë‹¤.

						title = info.event.title;
						content = info.event.extendedProps.content;
						deleteBtn = $("#delCalendar");
						if (title != null || title != '') {
							/* ì¶”ê°€ì˜€ì§€ë§Œ ë“±ë¡ëœê±¸ ëˆ„ë¥´ë©´ ìˆ˜ì • */

							$("#addCalendar").text('ìˆ˜ì •');
							deleteBtn.css("display", "inline");
							//                         $("#deleteCalendar").attr("style","display:inline");
						}
						//ê²€ìƒ‰ê²€ìƒ‰
						modal.show();
						$('#calendarModal').modal();
						$('#studyCode').val(groupId);
						$("#calendar_title").val(title);
						$("#calendar_content").val(content);
						//startDateì™€ endDateëŠ” ì‹œê°„ë‚ ì§œ í•©ì¹œê±°ë¼ê³  í•˜ê¸°ì—ëŠ”...ì• ë§¤í•œë°.. 
						$("#calendar_start_date").val(startDate);
						$("#calendar_end_date").val(endDate);
						$("#startTime").val(startTime);
						$("#endTime").val(endTime);
						$(".barColor").val(barColor)//ìƒ‰ê¹”

					},
					//ì´ë²¤íŠ¸ ë¶€ë¶„ì— ë°ì´í„°ê°€ ì•„ë¬´ê²ƒë„ ì—†ìœ¼ë‹ˆê¹ ì•„ë¬´ê²ƒë„ ì•ˆë–´ì§€..ì£½ì
					//ë¹„ë™ê¸°ë¼ ë”°ë¡œë…¸ëŠ” ë¶€ë¶„ì„
					events: data
					//                      [
					//                       {
					//                          title: 'All Day Event',
					//                          start: '2023-04-06',
					//                       },
					//                       {
					//                          title: 'All Day Event',
					//                          start: '2023-04-07',
					//                      }
					//                   ]
				});
				// full-calendar ìƒì„± ë///////////
				// ìº˜ë¦°ë” ëœë”ë§
				calendar.render();
			});
		});
	})();


</script>
<div class="row">
	<div class="col-xl-12">
		<div class="card dz-card" id="accordion-one">
			<div class="card-header flex-wrap">
				<div>
					<h4 class="card-title"
						style="color: #22313f; font-weight: 800; font-size: 18px;">${studyName }</h4>
				</div>
			</div>

			<div class="default-tab">
				<ul class="nav nav-tabs" role="tablist">
					<li class="nav-item"><a
						class="nav-link <c:if test="${active eq '1' }">active</c:if>"
						data-bs-toggle="tab" href="#stuList"><i class='far fa-user'></i>ã…¤ìŠ¤í„°ë””ì›</a>
					</li>
					<li class="nav-item"><a
						class="nav-link <c:if test="${active eq '2' }">active</c:if>"
						data-bs-toggle="tab" href="#calendar1"><i
							class='far fa-calendar-alt'></i>ã…¤ê·¸ë£¹ì¼ì •</a></li>
					<li class="nav-item"><a class="nav-link" data-bs-toggle="tab"
						href="#timetable"><i class='far fa-window-restore'></i>ã…¤ì‹œê°„í‘œë¹„êµ</a></li>
					<li class="nav-item"><a class="nav-link" data-bs-toggle="tab"
						href="#message"><i class='far fa-comments'></i>ã…¤ì±„íŒ…</a></li>
				</ul>
				<!-- ìŠ¤í„°ë””ì› ë¦¬ìŠ¤íŠ¸ -->
				<div class="tab-content">
					<div class="tab-pane fade <c:if test="${active eq '1' }">show active</c:if>"
						id="stuList" role="tabpanel">
						<div class="pt-4">
							<div class="tab-pane fade show active" id="Preview"
								role="tabpanel" aria-labelledby="home-tab">
								<div class="card-body pt-0">
									<div class="table-responsive">
										<table id="example" class="display table"
											style="min-width: 845px">
											<thead>
												<tr>
													<th>#</th>
													<th>í•™ë²ˆ</th>
													<th>í•™ê³¼</th>
													<th>ì´ë¦„</th>
													<th>ë¶„ë¥˜</th>
												</tr>
											</thead>
											<tbody id="yujin">
												<c:set value="${studyVO }" var="studyList" />
												<c:choose>
													<c:when test="${empty studyList}">
														<tr>
															<td colspan="5" style="text-align: center;">ì¡°íšŒí•˜ì‹ 
																ê²Œì‹œê¸€ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</td>
														</tr>
													</c:when>
													<c:otherwise>
														<c:forEach items="${studyVO }" var="study">
															<tr data-tr-id="${study.stuId}">
																<td class="nRum">${study.rnum}</td>
																<td>${study.stuId }</td>
																<td>${study.deptName }</td>
																<td>${study.stuNameKo}</td>
																<c:choose>
																	<c:when test="${study.smLeader eq 'Y'}">
																		<td>ìŠ¤í„°ë””ì¥</td>
																	</c:when>
																	<c:otherwise>
																		<td>ìŠ¤í„°ë””ì›</td>
																	</c:otherwise>
																</c:choose>
															</tr>
														</c:forEach>
													</c:otherwise>
												</c:choose>
											</tbody>
										</table>
									</div>
								</div>
							</div>

							<c:if test="${studyL.smLeader eq 'Y'}">
								<div class="tab-content" id="myTabContent">
									<div class="tab-pane fade show active" id="Preview"
										role="tabpanel" aria-labelledby="home-tab">
										<div class="card-body pt-0">
											<div class="table-responsive">
												<table id="example" class="display table"
													style="min-width: 845px">

													<thead>
														<h5>ğŸ–Šì°¸ì—¬ëŒ€ê¸°</h5>
														<tr>
															<th>í•™ë²ˆ</th>
															<th>í•™ê³¼</th>
															<th>ì´ë¦„</th>
															<th>ì‹ ì²­ì¼ì‹œ</th>
															<th>ì§€ì›ë™ê¸°</th>
															<th></th>
														</tr>
													</thead>
													<tbody>
														<c:set value="${msgList }" var="msg" />
														<c:choose>
															<c:when test="${empty msg}">
																<tr>
																	<td colspan="5" style="text-align: center;">ì¡°íšŒí•˜ì‹ 
																		ê²Œì‹œê¸€ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</td>
																</tr>
															</c:when>
															<c:otherwise>
																<c:forEach items="${msgList}" var="msg">
																	<tr data-msg-id="${msg.msgDate}">
																		<td class="nStuId">${msg.msgSender}</td>
																		<td class="nStuAca">${msg.acaMajor}</td>
																		<td class="nStuNm">${msg.stuNameKo}</td>
																		<td>${msg.msgDate}</td>
																		<td>
																			<button type="button"
																				class="btn btn-primary btn-sm px-4 "
																				data-bs-container="body" data-bs-toggle="popover"
																				data-bs-placement="left"
																				data-bs-content="${msg.msgContent }"
																				data-bs-original-title="Popover in Left"
																				aria-describedby="popover373619">í™•ì¸</button>
																		</td>
																		<td>
																			<button type="button"
																				class="btn tp-btn-light btn-info accept-btn"
																				data-stu-id="${msg.msgSender}"
																				data-study-code="${studyCode}" data-study-status="Y"
																				data-msg-content="${msg.msgContent}">ìˆ˜ë½</button>
																			<button type="button"
																				class="btn tp-btn-light btn-danger reject-btn"
																				data-stu-id="${msg.msgSender}"
																				data-study-code="${studyCode}" data-study-status="N"
																				data-msg-content="${msg.msgContent}">ë°˜ë ¤</button>
																		</td>
																	</tr>
																</c:forEach>
															</c:otherwise>
														</c:choose>
													</tbody>
												</table>
											</div>
										</div>
									</div>
								</div>
							</c:if>
						</div>
					</div>

					<!-- ìŠ¤í„°ë””ë³„ ìº˜ë¦°ë” -->
					<div class="tab-pane fade <c:if test="${active eq '2' }">show active</c:if>"
						id="calendar1">
						<div class="pt-4">
							<div class="tab-pane fade show active" id="Preview"
								role="tabpanel" aria-labelledby="home-tab">
								<div class="card-body pt-0">
									<div class="table-responsive">
										<!-- ëª¨ë‹¬ì°½  ì‹œì‘ -->
										<div class="modal fade" id="calendarModal" tabindex="-1"
											role="dialog" aria-labelledby="exampleModalLabel"
											aria-hidden="true" style="display: none;">
											<div class="modal-dialog modal-dialog-centered" role="document">
												<div class="modal-content" id="modalBox"
													style="display: block;">
													<div class="modal-header">
														<span id="closeBtn" class="close" data-dismiss="modal"
															aria-label="Close"
															style="margin-left: 380px; display: inline;">X</span>
														<h3 class="modal-title" id="exampleModalLabel"
															style="margin: 0">ì¼ì • ë“±ë¡</h3>
														<hr />
													</div>
													<div class="modal-body">
														<!-- ì—¬ê¸°ê°€ ì•„ë‹ˆë¼ ìœ„ì—ë‹¤ studyCode.val()ìœ¼ë¡œ ì§ì ‘ ë„£ì–´ì¤¬ìŒ... -->
														<input type="hidden" id="studyCode" name="studyCode"
															value="${studyCode}">
														<!-- nameì˜ í–‰ë°©ì´ë§¤ìš° ê¶ê¸ˆí–ˆì—ˆìŒ. -->
														<!-- nameì´ë‘ VO ê°€ ì•ˆì´ì–´ì ¸ë„ ë˜ëŠ” ì´ìœ ëŠ” controllerì—ì„œ putìœ¼ë¡œ ë°ì´í„°ë¥¼ ë„£ëŠ” ì‘ì—…ì„ í•´ì£¼ì—ˆê¸° ë–„ë¬¸ì— ì•ˆí•´ë„ ë˜ëŠ”ê²ƒê°™ìŒ..   -->
														<input type="hidden" id="calNo" name="calNo" value=""><br />

														<div>
															ì¼ì • ì œëª© <input type="text" class="form-control"
																id="calendar_title" name="calendar_title">
														</div>
														<div>
															ë‚´ìš©<br> <br>
															<textarea class="form-control" id="calendar_content"
																name="calendar_content" rows="10" cols="50"
																style="margin-left: 10px"></textarea>
															<br> <br>
														</div>
														<div class="row">
															<div class="col-sm-6">
																<label for="calendar_start_date">ì‹œì‘ ë‚ ì§œ</label> <input
																	type="date" class="form-control"
																	id="calendar_start_date" name="calendar_start_date">
															</div>
															<div class="col-sm-6">
																<label for="startTime">ì‹œì‘ ì‹œê°„</label> <input type="time"
																	id="startTime" name="startTime" class="form-control">
															</div>
														</div>
														<div class="row">
															<div class="col-sm-6">
																<label for="calendar_end_date">ì¢…ë£Œ ë‚ ì§œ</label> <input
																	type="date" class="form-control" id="calendar_end_date"
																	name="calendar_end_date">
															</div>
															<div class="col-sm-6">
																<label for="endTime">ì¢…ë£Œ ì‹œê°„</label> <input type="time"
																	id="endTime" name="endTime" class="form-control">
															</div>
														</div>
														<div>
															ìƒ‰ê¹” ì„ íƒ
															<div class="row" style="display: flex; flex-wrap: wrap;">
																<div
																	class="form-check custom-checkbox mb-3 checkbox-danger"
																	style="flex-basis: 25%;">
																	<input type="radio" class="form-check-input barColor"
																		id="customRadioBox6" name="optradioCustom"
																		data-value="red"> <label
																		class="form-check-label" for="customRadioBox6">ë¹¨ê°•</label>
																</div>
																<div
																	class="form-check custom-checkbox mb-3 checkbox-warning"
																	style="flex-basis: 25%;">
																	<input type="radio" class="form-check-input barColor"
																		id="customRadioBox5" name="optradioCustom"
																		data-value="orange"> <label
																		class="form-check-label" for="customRadioBox5">ì˜¤ë Œì§€</label>
																</div>
																<div
																	class="form-check custom-checkbox mb-3 checkbox-info"
																	style="flex-basis: 25%;">
																	<input type="radio" class="form-check-input barColor"
																		id="customRadioBox3" name="optradioCustom"
																		data-value="blue"> <label
																		class="form-check-label" for="customRadioBox3">íŒŒë‘</label>
																</div>
																<div
																	class="form-check custom-checkbox mb-3 checkbox-success"
																	style="flex-basis: 25%;">
																	<input type="radio" class="form-check-input barColor"
																		id="customRadioBox4" name="optradioCustom"
																		data-value="green"> <label
																		class="form-check-label" for="customRadioBox4">ì´ˆë¡</label>
																</div>
															</div>
														</div>
													</div>
													<div class="modal-footer">
														<button type="button" class="ì¶”ê°€ btn tp-btn-light btn-info"
															id="addCalendar">ì¶”ê°€</button>
														<button type="button"
															class="ë”œë¦¬íŠ¸ btn tp-btn-light btn-danger" id="delCalendar"
															style="display: none">ì‚­ì œ</button>
														<button type="button"
															class="ì·¨ì†Œ btn tp-btn-light btn-warning" id="modalClose"
															data-dismiss="modal">ì·¨ì†Œ</button>
													</div>
												</div>
											</div>
										</div>
									</div>
									<!-- ëª¨ë‹¬ì°½ ë -->

									<!-- ìº˜ë¦°ë” -->
									<div id='calendar-container'>
										<div id='calendar'></div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- ì‹œê°„í‘œë¹„êµ -->
					<div class="tab-pane fade" id="timetable">
						<div class="pt-4">
							<div class="tab-pane fade show active" id="Preview"
								role="tabpanel" aria-labelledby="home-tab">
								<div class="card-body pt-0">
									<div class="table-responsive">
										<div class="row">
											<div class="col-md-4">
												<div class="card">
													<div class="card-header">
														<div class="card-title">
															<span style="font-size: 18px; color: #f96d00">|</span>
															ìŠ¤í„°ë””ì›ëª©ë¡
														</div>
													</div>

													<div class="card-body">
														<div class="row">
															<div class="table-responsive">
																<table class="table text-center"
																	id="studyListTbl">
																	<thead>
																		<tr>
																			<th>ìŠ¤í„°ë””ì›</th>
																			<th>ì „ê³µ</th>
																			<th>í•™ë²ˆ</th>
																		</tr>
																	</thead>
																	<tbody>
																		<c:forEach items="${studyVO }" var="study">
																			<tr class="member">
																				<td>${study.stuNameKo}</td>
																				<td>${study.deptName }</td>
																				<td>${study.stuId }</td>
																			</tr>
																		</c:forEach>
																	</tbody>
																</table>
															</div>
														</div>
													</div>
												</div>
											</div>

											<div class="col-md-8">
												<div class="card">
													<div class="card-header">
														<div class="card-title">
															<span style="font-size: 18px; color: #f96d00">|</span>
															ì‹œê°„í‘œ ë¹„êµ
														</div>
													</div>
													<div class="card-body">
														<div class="table table-responsive">
															<div class="row"></div>
															<div>
																<table class="table table-bordered text-center"
																	id="timeTbl">
																	<thead>
																		<tr id="datTr">
																			<th style="width: 15%;"></th>
																			<th>ì›”</th>
																			<th>í™”</th>
																			<th>ìˆ˜</th>
																			<th>ëª©</th>
																			<th>ê¸ˆ</th>
																		</tr>
																	</thead>
																	<tbody>
																		<tr>
																			<td>09:00</td>
																			<td></td>
																			<td></td>
																			<td></td>
																			<td></td>
																			<td></td>
																		</tr>
																		<tr>
																			<td>10:00</td>
																			<td></td>
																			<td></td>
																			<td></td>
																			<td></td>
																			<td></td>
																		</tr>
																		<tr>
																			<td>11:00</td>
																			<td></td>
																			<td></td>
																			<td></td>
																			<td></td>
																			<td></td>
																		</tr>
																		<tr>
																			<td>12:00</td>
																			<td></td>
																			<td></td>
																			<td></td>
																			<td></td>
																			<td></td>
																		</tr>
																		<tr>
																			<td>13:00</td>
																			<td></td>
																			<td></td>
																			<td></td>
																			<td></td>
																			<td></td>
																		</tr>
																		<tr>
																			<td>14:00</td>
																			<td></td>
																			<td></td>
																			<td></td>
																			<td></td>
																			<td></td>
																		</tr>
																		<tr>
																			<td>15:00</td>
																			<td></td>
																			<td></td>
																			<td></td>
																			<td></td>
																			<td></td>
																		</tr>
																		<tr>
																			<td>16:00</td>
																			<td></td>
																			<td></td>
																			<td></td>
																			<td></td>
																			<td></td>
																		</tr>
																		<tr>
																			<td>17:00</td>
																			<td></td>
																			<td></td>
																			<td></td>
																			<td></td>
																			<td></td>
																		</tr>
																		<tr>
																			<td>18:00</td>
																			<td></td>
																			<td></td>
																			<td></td>
																			<td></td>
																			<td></td>
																		</tr>
																	</tbody>
																</table>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="tab-pane fade" id="message">
						<div class="pt-4">
							<div class="tab-pane fade show active" id="Preview"
								role="tabpanel" aria-labelledby="home-tab">
								<div class="card-body pt-0">
									<div class="table-responsive">
										<h4>This is message title</h4>
										<p>Raw denim you probably haven't heard of them jean
											shorts Austin. Nesciunt tofu stumptown aliqua, retro synth
											master cleanse. Mustache cliche tempor.</p>
										<p>Raw denim you probably haven't heard of them jean
											shorts Austin. Nesciunt tofu stumptown aliqua, retro synth
											master cleanse. Mustache cliche tempor.</p>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script>/* ìŠ¤í„°ë””ì› ë¦¬ìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ */
	$(function () {
		// ê° ë²„íŠ¼ì— ëŒ€í•´ í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡
		var nStuId = null;
		var nStuAca = null;
		var nStuNm = null;
		var lastRnum = null;
		let members = [];

		// í•´ë‹¹ tdì— ì‹œê°„í‘œ í‘œì‹œ ì—¬ë¶€ dataê°’ ì„¤ì •
		$("#timeTbl td").attr("data-status", 0);
		console.log("timeTbl > td: ", $(this));

		// ìŠ¤í„°ë””ì› ì„ íƒ ì—¬ë¶€ dataê°’ ì„¤ì •
		$(".member").attr("data-select", "N");

		$(".nav").on("click", "a", function () {
			$("#calendar").find(".fc-dayGridMonth-button").click();
		});

		$('.accept-btn').click(function () {
			var $this = $(this); // í´ë¦­ëœ ë²„íŠ¼ ìš”ì†Œ ì €ì¥
			var stuId = $(this).data('stu-id');
			var studyCode = $(this).data('study-code');
			var studyStatus = $(this).data('study-status');
			var msgContent = $(this).data('msg-content');
			var msgId = $(this).closest('tr').data('msg-id');
			var obj = {
				"stuId": stuId,
				"studyCode": studyCode,
				"studyStatus": studyStatus,
				"msgContent": msgContent
			};
			$.ajax({
				type: "post",
				url: "/study/insert",
				dataType: "text",
				data: obj,
				success: function (res) {
					console.log("res>>", res);
					alert("ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤");
					var nStuId = $this.parent().parent().find('.nStuId').text();
					var nStuAca = $this.parent().parent().find('.nStuAca').text();
					var nStuNm = $this.parent().parent().find('.nStuNm').text();
					var lastRnum = parseInt($('#yujin').find('.nRum').text());
					var nRum = lastRnum + 1;
					console.log("nStuId>>>", nStuId);
					$('tr[data-msg-id="' + msgId + '"]').remove();

					var newStudyMemElem = `
                  <tr>
                    <td>\${nRum}</td>
                    <td>\${nStuId}</td> 
                    <td>\${nStuAca}</td>
                    <td>\${nStuNm}</td>
                    <td>ìŠ¤í„°ë””ì›</td>
                  </tr>
                `;
					$('#yujin').append(newStudyMemElem);
				},
				error: function (err) {
					console.log("err>>", err);
					alert("ìŠ¹ì¸ì‹ ì²­ì— ì‹¤íŒ¨");
					$('.standByDelete').remove();
				}
			});

		});


		$('.reject-btn').click(function () {
		   var stuId = $(this).data('stu-id');
		   var studyCode = $(this).data('study-code');
		   var studyStatus = $(this).data('study-status');
		   var msgContent = $(this).data('msg-content');
		   var obj = {
				"stuId": stuId,
				"studyCode": studyCode,
				"studyStatus": studyStatus,
				"msgContent": msgContent
			};
			console.log("studyObj>> ", obj);
			$.ajax({
				type: "post",
				url: "/study/insert",
				dataType: "text",
				data: obj,
				success: function (res) {
					console.log("res>>", res);
					alert("ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤");
					$('.standByDelete').remove();
				},
				error: function (err) {
					console.log("err>>", err);
					alert("ë°˜ë ¤ ì²˜ë¦¬ì— ì‹¤íŒ¨");
				}
			});
		});

		/* ì„ íƒí•œ tr í‘œì‹œ css ë„£ê¸° */
    function trBgDraw(p_this) {
			p_this.css({
				"background": "linear-gradient(to bottom, #add8e6, #f7f7f7)",
				"box-shadow": "0px 2px 4px rgba(0,0,0,0.3), 0px 4px 8px rgba(0,0,0,0.2), 0px 8px 16px rgba(0,0,0,0.1)"
			});
		}

		/* ì„ íƒí•œ tr í‘œì‹œ ë¦¬ì…‹ */
    function trBgDrawReset(p_this) {
      p_this.removeAttr("style");
    }

		// í•™ìƒ ì‹œê°„í‘œ ê·¸ë¦¬ê¸°
		function addStuTime(stuTime){
      let table = document.getElementById("timeTbl");

      for(i=0; i<stuTime.length; i++){
        let startRow = (parseInt(stuTime[i].lrsStart.substr(1)) - 9) + 1;
        let endRow = (parseInt(stuTime[i].lrsEnd.substr(1)) - 9) + 1;
        let dayCol = 0;
  
        switch (stuTime[i].weekCode) {
          case "MON":
            dayCol = 1;
            break;
          case "TUE":
            dayCol = 2;
            break;
          case "WED":
            dayCol = 3;
            break;
          case "THU":
            dayCol = 4;
            break;
          case "FRI":
            dayCol = 5;
            break;
          default:
            return;
        }

        for (let j = startRow; j <= endRow; j++) {
          let cell = table.rows[j].cells[dayCol];
					let stat = parseInt($(cell).attr("data-status")); 

					if(stat == 0){ // data-status = 0 ì¼ ë•Œ
						cell.style.backgroundColor = "#A4C3FF";
					}else{
						cell.style.backgroundColor = "#FF6464";
					}

          stat += 1;
					$(cell).attr("data-status", stat);
        }
      }
    }

		// í•™ìƒ ì‹œê°„í‘œ ë¹¼ê¸°
		function removeStuTime(stuTime){
      let table = document.getElementById("timeTbl");

      for(i=0; i<stuTime.length; i++){
        let startRow = (parseInt(stuTime[i].lrsStart.substr(1)) - 9) + 1;
        let endRow = (parseInt(stuTime[i].lrsEnd.substr(1)) - 9) + 1;
        let dayCol = 0;
  
        switch (stuTime[i].weekCode) {
          case "MON":
            dayCol = 1;
            break;
          case "TUE":
            dayCol = 2;
            break;
          case "WED":
            dayCol = 3;
            break;
          case "THU":
            dayCol = 4;
            break;
          case "FRI":
            dayCol = 5;
            break;
          default:
            return;
        }

        for (let j = startRow; j <= endRow; j++) {
          let cell = table.rows[j].cells[dayCol];
					let stat = parseInt($(cell).attr("data-status")); 
					stat -= 1;
					$(cell).attr("data-status", stat);

					if(stat == 0){ // data-status = 0 ì¼ ë•Œ
						cell.style.backgroundColor = "white";
					}else if(stat == 1){	// ê²¹ì¹˜ëŠ” ì‹œê°„ ì—†ì„ ë•Œ
						cell.style.backgroundColor = "#A4C3FF";
					}else {	// ì‹œê°„ ê²¹ì¹  ë•Œ
						cell.style.backgroundColor = "#FF6464";
					}
        }
      }
    }
    

		$(document).on("click", ".member", function(){
			if($(this).attr("data-select") == "N"){	// ë©¤ë²„ ì„ íƒ
				$(this).attr("data-select", "Y");
				trBgDraw($(this));
				let stuId = $(this).find('td:eq(2)').text();

				$.ajax({
					type: "get",
					url: `/study/getStuTime/\${stuId}`,
					success: function(res){
						console.log("ì„ íƒí•œ í•™ìƒ ì‹œê°„í‘œ:", res);
						addStuTime(res);
					}
				});

				return false;
			}

			if($(this).attr("data-select") == "Y"){	// ë©¤ë²„ ì„ íƒ í•´ì œ
				$(this).attr("data-select", "N");
				trBgDrawReset($(this));

				let stuId = $(this).find('td:eq(2)').text();

				$.ajax({
					type: "get",
					url: `/study/getStuTime/\${stuId}`,
					success: function(res){
						console.log("ì„ íƒí•œ í•™ìƒ ì‹œê°„í‘œ:", res);
						removeStuTime(res);
					}
				});

				return false;
			}
		});

	});


</script>
